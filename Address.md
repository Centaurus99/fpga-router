Thinpad 工程
---------------

### Wishbone 总线地址设定

#### 时钟中断

|    地址    |                     说明                     |
| :--------: | :------------------------------------------: |
| 0x0200BFF8 |      mtime，64位，可读写。表示当前时间       |
| 0x02004000 | mtimecmp，64位，可读写。表示下次时钟中断时间 |

#### UART 串口

|    地址    |  位   |                        说明                        |
| :--------: | :---: | :------------------------------------------------: |
| 0x10000000 | [7:0] | 串口数据，读、写地址分别表示串口接收、发送一个字节 |
| 0x10000005 |  [5]  |        只读，为1时表示串口空闲，可发送数据         |
| 0x10000005 |  [0]  |            只读，为1时表示串口收到数据             |

#### GPIO

|       地址区间        |                    说明                    |
| :-------------------: | :----------------------------------------: |
| 0x20000000-0x20000003 |            32位拨码开关（只读）            |
| 0x20000004-0x20000005 |              16位leds（读写）              |
| 0x20000008-0x20000008 | 4位touch_btn（在第一个字节的低四位，只读） |
| 0x2000000c-0x2000000d |           8位dpy0和dpy1（读写）            |

#### BRAM——VGA图片存储（已禁用）

|       地址区间        | 说明  | 存储单元数据位宽 | 对齐后数据位宽 | 存储单元地址数量 | 存储单元地址位宽 | BRAM 数量 |
| :-------------------: | :---: | :--------------: | :------------: | :--------------: | :--------------: | :-------: |
| 0x30000000-0x30FFFFFF | BRAM1 |        32        |       32       |      480000      |        19        |   107.5   |

#### BRAM——转发表内部节点

|       地址区间        | 说明  | 存储单元数据位宽 | 对齐后数据位宽 | 存储单元地址数量 | 存储单元地址位宽 | BRAM 数量 | IP 地址前缀 |
| :-------------------: | :---: | :--------------: | :------------: | :--------------: | :--------------: | :-------: | :---------: |
| 0x40000000-0x40FFFFFF | BRAM1 |        72        |      128       |      25600       |        15        |    50     |    0-15     |
| 0x41000000-0x41FFFFFF | BRAM2 |        72        |      128       |      51200       |        16        |    100    |    16-31    |
| 0x42000000-0x42FFFFFF | BRAM3 |        72        |      128       |      51200       |        16        |    100    |    32-47    |
| 0x43000000-0x43FFFFFF | BRAM0 |        72        |      128       |       1024       |        10        |     2     |    48-63    |
| 0x44000000-0x44FFFFFF | BRAM0 |        72        |      128       |       1024       |        10        |     2     |    64-79    |
| 0x45000000-0x45FFFFFF | BRAM0 |        72        |      128       |       1024       |        10        |     2     |    80-95    |
| 0x46000000-0x46FFFFFF | BRAM0 |        72        |      128       |       1024       |        10        |     2     |   96-111    |
| 0x47000000-0x47FFFFFF | BRAM0 |        72        |      128       |       1024       |        10        |     2     |   112-127   |

#### LUTRAM——叶节点和 Next-Hop 节点

|       地址区间        |     说明      | 存储单元数据位宽 | 对齐后数据位宽 | 存储单元地址数量 | 存储单元地址位宽 | LUT 数量 |
| :-------------------: | :-----------: | :--------------: | :------------: | :--------------: | :--------------: | :------: |
| 0x50000000-0x50FFFFFF |    叶节点     |        8         |       32       |      10240       |        14        |   未知   |
| 0x51000000-0x51FFFFFF | Next-Hop 结点 |       136        |      256       |       128        |        7         |   未知   |

#### 路由器 MMIO&DMA

##### 路由端口统计数据

- `0x6000_0p00` 为 p 端口 32 位发包字节计数
- `0x6000_0p04` 为 p 端口 32 位收包字节计数

|       地址区间        |       说明        |
| :-------------------: | :---------------: |
| 0x60000000-0x600000FF | 路由器端口 0 统计 |
| 0x60000100-0x600001FF | 路由器端口 1 统计 |
| 0x60000200-0x600002FF | 路由器端口 2 统计 |
| 0x60000300-0x600003FF | 路由器端口 3 统计 |

##### 路由器端口配置

- `0x6100_0p00` 为 p 端口 48 位 mac 地址（对齐至 64 位，低 48 位有效）
- `0x6100_0p08` 为 eui64 只写控制寄存器（对齐至 64 位），向该地址写入任何非零值会导致该端口链路本地地址会被 eui64 生成的地址覆盖
- `0x6100_0p10` 为 p 端口 128 位 ipv6 链路本地地址
- `0x6100_0p20` 为 p 端口 128 位 ipv6 GUA 地址

|       地址区间        |       说明        |
| :-------------------: | :---------------: |
| 0x61000000-0x610000FF | 路由器端口 0 配置 |
| 0x61000100-0x610001FF | 路由器端口 1 配置 |
| 0x61000200-0x610002FF | 路由器端口 2 配置 |
| 0x61000300-0x610003FF | 路由器端口 3 配置 |

##### DMA 控制 MMIO

|    地址    |  位  |                             说明                             |
| :--------: | :--: | :----------------------------------------------------------: |
| 0x62000000 | [0]  | （可读写）DMA CPU 锁<br />写入 1 为请求使用，请求不一定成功，写入后须读取验证<br />写入 0 为请求结束使用 |
| 0x62000000 | [1]  |                    （可读）DMA Router 锁                     |
| 0x62000000 | [2]  |    （可读写）等待 CPU 读取<br />写入 1 表示 CPU 读取完成     |
| 0x62000000 | [3]  |   （可读写）等待 Router 读取<br />写入 1 表示 CPU 写入完成   |

##### DMA 共享内存 BRAM

|       地址区间        |      说明      | 存储单元数据位宽 | 存储单元地址数量 | 存储单元地址位宽 | BRAM 数量 |
| :-------------------: | :------------: | :--------------: | :--------------: | :--------------: | :-------: |
| 0x68000000-0x680003FF | 前四字节为长度 |        32        |       1024       |        10        |     1     |

#### SRAM

|       地址区间        |   说明   |
| :-------------------: | :------: |
| 0x80000000-0x803FFFFF | Base RAM |
| 0x80400000-0x807FFFFF | Ext RAM  |

#### Flash（预留，已禁用）

|       地址区间        |              说明               |
| :-------------------: | :-----------------------------: |
| 0x90000000-0x907FFFFF | BaseRAM与ExtRAM的初始数据的存储 |

